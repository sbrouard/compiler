<html><head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" media="screen" type="text/css" href="IF203:%20projet%20de%20compilation_fichiers/style.css">
    <title>IF203: projet de compilation</title>
  </head>

  <body>
 <h1>Compilateur C vers JavaScript
<div>
  <ul>
    <li><a href="http://people.bordeaux.inria.fr/sergent/IF204/projet.html">Objectifs</a></li>
    <li><a href="http://people.bordeaux.inria.fr/sergent/IF204/langage.html">Langage</a></li>
    <li><a href="http://people.bordeaux.inria.fr/sergent/IF204/priseenmain.html">Prise en main</a></li>
    <li><a href="http://people.bordeaux.inria.fr/sergent/IF204/ir.html">Assembleur LLVM</a></li>
    <li><a href="http://people.bordeaux.inria.fr/sergent/IF204/sources.html">Les sources</a></li>
 </ul>
 </div>
 </h1>
 Le but de ce projet est, à partir d'un langage ressemblant à du C
 dans lequel on a ajouté des fonctions graphiques, de pouvoir compiler 
vers du javascript efficace et d'obtenir un rendu dans un navigateur.

<br>
Ce travail est à réaliser en binôme.
<p>
Votre objectif est de développer un compilateur qui traduit le langage d'entrée du projet en du code
intermédiaire décrit en assembleur <a href="http://people.bordeaux.inria.fr/sergent/IF204/ir.html">LLVM.</a>
<br>
L'appel au compilateur <a href="http://kripken.github.io/emscripten-site/index.html">Emscripten</a>
permettra ensuite de finir la compilation vers du JavaScript optimisé au format
asm.js depuis la représentation intermédiaire LLVM.<br>
</p>

<p>
Pour obtenir un rendu dans une page web, le langage d'entrée devra implémenter certaines
fonctions de la bibliothèque de dessin <a href="https://p5js.org/">p5.js</a>. <br>

Cette page web devra charger la bibliothèque p5.js,
et le script sketch.js qui sert à appeler les fonctions <code>my_setup</code> et
<code>my_draw</code> qui ont été compilées par <b>Emscripten</b> en asm.js.

</p>

<pre>  <img src="IF203:%20projet%20de%20compilation_fichiers/toolchain.jpeg" alt="compiler toolchain" style="width:800px">
</pre>

La grammaire et l'analyseur syntaxique pour le langage d'entrée sont fournis pour
lex et yacc.

<h2>Exemple</h2>

Vous trouverez ci-dessous en exemple de code du langage d'entrée avec le rendu obtenu.

<pre>  <div class="example">
double w, h;
double bail_out;
double zoom_factor, zoom;

void my_setup()
{
  w = 640; h = 480;
  bail_out = 2.0;
  zoom_factor = 1.4;  zoom = (w * 0.25296875);
  // Définit la taille de la zone d'affichage
  createCanvas(w, h);

}

void my_draw()
{
  int x,y; double n;
  int maxiter = (w/2) * 0.049715909 * log10(zoom);
  double zr,zi,cr,ci;
  double centerr = -0.800671;
  double centeri = 0.158392;

  for  (y = 0; y &lt; h; y++)  {
    for (x = 0; x &lt; w; x++) {
      double m=0;
      /* Get the complex poing on gauss space to be calculate */
      zr=cr=centerr + (x - (w/2))/zoom;
      zi=ci=centeri + (y - (h/2))/zoom;
      /* Applies the actual mandelbrot formula on that point */
      for (n = 0; n &lt;= maxiter &amp;&amp; m &lt; bail_out * bail_out; n ++) {
	double a=zr*zr-zi*zi+cr;
	double b=2*zr*zi+ci;
	zr=a;
	zi=b;
	m=a*a+b*b;
      }

      /* Paint the pixel calculated depending on the number
	 of iterations found */
      int color;
      if (n &lt; maxiter)
	color = n / maxiter * 255;
      else color=0;

      stroke(color);
      point(x, y);
    }
  }

  zoom *= zoom_factor;
}
</div>
</pre>



<div style="margin-left: 700px;">
  <img src="IF203:%20projet%20de%20compilation_fichiers/snapshot.jpg" alt="rendu">
</div>

<div style="clear:both;"></div>


<h2>Objectifs du projet</h2>
L'objectif du projet est d'implémenter un compilateur pour le langage 
défini par la grammaire donnée. La sémantique sera celle du C, avec les 
restrictions suivantes:
<ul>
<li>Pas de pointeurs (*), de structures, d'unions</li>
<li>Pas de tableaux</li>
</ul>
Le compilateur devra indiquer s'il trouve des erreurs de syntaxe, sur quelle ligne, et s'il y a des erreurs de typage. 

<h3>Fonctions de dessin</h3>

Les fonctions suivantes de la bibliothèque p5.js devront être implémentées dans le langage :

<ul>
  <li><a href="https://p5js.org/reference/#/p5/createCanvas">createCanvas(double, double)</a></li>
  <li><a href="https://p5js.org/reference/#/p5/background">background(double)</a></li>
  <li><a href="https://p5js.org/reference/#/p5/fill">fill(double)</a></li>
  <li><a href="https://p5js.org/reference/#/p5/stroke">stroke(double)</a></li>
  <li><a href="https://p5js.org/reference/#/p5/point">point(double, double)</a></li>
  <li><a href="https://p5js.org/reference/#/p5/line">line(double, double, double, double)</a></li>
  <li><a href="https://p5js.org/reference/#/p5/ellipse">ellipse(double, double, double, double)</a></li>
</ul>

<h3>Fonctionnalités facultatives</h3>
Un ensemble de fonctionnalités facultatives peut être implémenté:
<ul>
  <li>Ajout d'autres fonctions de la bibliothèque p5.js. </li>
  <li>Messages d'erreur intelligents. </li>
  <li>Gestion des chaînes de caractères ainsi que l'ajout des 3 
fonctions suivantes: void print_int(int), void print_double(double), 
void print_string(char *). </li>
  <li>Gestion des tableaux. </li>
  <li>Implémentation d'un autre backend (SDL ou Cairo) afin de générer un binaire C à la place de l'asm.js.
</li></ul>
Toute autre extension pourra être proposée. 

<h2>À Rendre</h2>

<ul>
  <li>Un rapport et une archive de programmes de tests. Le rapport présentera
      brièvement le langage ainsi que les tests. Une dizaine de tests minimum
      sont attendus. </li>
  <li>Une archive avec les sources de votre compilateur. Le compilateur doit
      pouvoir compiler sur les machines de l'enseignement. Le makefile doit être
      fonctionnel. </li>
</ul>
Une soutenance orale sera organisée, où chaque groupe présentera en
5 minutes ce que fait son compilateur.<br><br>

<h2>Évaluation</h2> 
L'évaluation sera basée sur ces critères (dans cet
ordre, du plus important au moins important):
<ul>
<li>Le compilateur fonctionne pour l'ensemble des fonctionnalités décrites pour le langage et génère un code correct.
</li><li>La stabilité du compilateur (pas de plantage lors de la compilation)
</li><li>La qualité du rapport.
</li><li>Les fonctionnalités facultatives implémentées.
</li></ul>



</body></html>